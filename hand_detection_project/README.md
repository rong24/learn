# 增强型手部骨骼轮廓检测项目

这是一个基于OpenCV和MediaPipe的实时手部骨骼轮廓识别项目，具有增强的骨骼结构可视化和手势识别功能。

## ✨ 功能特性

### 🎥 实时检测
- 实时摄像头视频流处理
- 多手检测（最多2只手）
- 高精度手部关键点检测（21个关键点）

### 🦴 骨骼结构可视化
- **增强骨骼显示**：彩色编码的手指骨骼结构
- **关键点连线**：标准MediaPipe手部连线
- **优化轮廓**：多层轮廓效果与半透明填充
- **手势分析**：实时手势识别和状态显示

### 🖐️ 手势识别
- 拳头、手掌张开、指向
- 数字手势（2、3、4）
- 拇指向上、胜利手势
- 摇滚手势识别

### 🎨 颜色编码
- **红色**：拇指骨骼
- **绿色**：食指骨骼
- **蓝色**：中指骨骼
- **青色**：无名指骨骼
- **紫色**：小指骨骼
- **白色**：手掌连接线
- **黄色**：手部轮廓

### 📊 多视图显示
四个实时视图窗口：
1. **Landmarks**：标准手部关键点
2. **Enhanced Skeleton**：彩色编码的骨骼结构
3. **Contours**：优化的轮廓显示
4. **Gesture Analysis**：骨骼+手势识别信息

## 🔧 系统要求

- Python 3.7+
- 摄像头设备
- Windows/MacOS/Linux
- 推荐：4GB RAM，支持OpenGL的显卡

## 📦 安装说明

### 1. 获取项目
```bash
cd hand_detection_project
```

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

或手动安装：
```bash
pip install opencv-python==4.8.1.78
pip install mediapipe==0.10.7
pip install numpy==1.24.3
```

### 3. 测试环境
```bash
python test_imports.py
```

### 4. 运行程序
```bash
python hand_detection.py
```

## 🎮 使用说明

### 基本操作
- **启动程序**：`python hand_detection.py`
- **退出程序**：按 `q` 键
- **保存当前帧**：按 `s` 键（保存手势分析帧）

### 显示界面
程序显示2×2的组合窗口：

```
┌─────────────┬─────────────────┐
│ Landmarks   │ Enhanced        │
│             │ Skeleton        │
├─────────────┼─────────────────┤
│ Contours    │ Gesture         │
│             │ Analysis        │
└─────────────┴─────────────────┘
```

### 手势识别显示
在"Gesture Analysis"窗口中显示：
- **Fingers**: 手指状态（01101 = 拇指+食指+中指伸展）
- **Gesture**: 识别的手势名称
- **Extended**: 伸展的手指数量
- **Hand Type**: 左手/右手
- **Confidence**: 检测置信度

## 🧠 技术原理

### MediaPipe手部模型
- 基于机器学习的手部检测
- 21个3D手部关键点
- 实时性能优化

### 骨骼结构算法
1. **关键点映射**：将21个关键点按手指分组
2. **骨骼连线**：根据解剖学连接各关节
3. **颜色编码**：为每个手指分配不同颜色
4. **增强渲染**：多层绘制（骨骼+关节+边框）

### 轮廓提取
1. 获取所有关键点坐标
2. 计算凸包（Convex Hull）
3. 多层轮廓绘制
4. 半透明填充效果

### 手势识别算法
```python
# 基于手指伸展状态的二进制编码
fingers = [thumb, index, middle, ring, pinky]  # 1=伸展，0=弯曲
gesture = recognize_gesture(fingers)
```

## 📁 项目结构

```
hand_detection_project/
├── hand_detection.py      # 主程序（优化版）
├── test_imports.py        # 环境测试脚本
├── requirements.txt       # 依赖包列表
└── README.md             # 项目文档
```

## 🏗️ HandDetector类详解

### 核心方法
- `detect_hands()`: 手部检测
- `draw_landmarks()`: 标准关键点绘制
- `draw_enhanced_skeleton()`: 增强骨骼绘制
- `get_hand_contour()`: 优化轮廓提取
- `get_finger_status()`: 手指状态分析
- `recognize_gesture()`: 手势识别
- `draw_finger_analysis()`: 分析信息绘制

### 关键属性
```python
# 手指关键点索引
finger_tips = [4, 8, 12, 16, 20]    # 指尖
finger_pips = [3, 6, 10, 14, 18]    # PIP关节
finger_mcp = [2, 5, 9, 13, 17]      # MCP关节

# 骨骼连接定义
finger_connections = [...]           # 每个手指的骨骼连接

# 颜色方案
colors = {...}                       # 彩色编码方案
```

## 🎯 支持的手势

| 手势 | 手指状态 | 描述 |
|------|----------|------|
| 拳头 | [0,0,0,0,0] | 所有手指弯曲 |
| 手掌张开 | [1,1,1,1,1] | 所有手指伸展 |
| 指向 | [0,1,0,0,0] | 仅食指伸展 |
| 数字2 | [0,1,1,0,0] | 食指+中指 |
| 数字3 | [0,1,1,1,0] | 食指+中指+无名指 |
| 数字4 | [0,1,1,1,1] | 四指伸展 |
| 拇指向上 | [1,0,0,0,0] | 仅拇指伸展 |
| 胜利手势 | [1,1,0,0,0] | 拇指+食指 |
| 摇滚手势 | [1,0,0,0,1] | 拇指+小指 |

## 🔧 参数调优

### 检测参数
```python
detector = HandDetector(
    max_num_hands=2,                    # 最大手数
    min_detection_confidence=0.7,       # 检测置信度
    min_tracking_confidence=0.5         # 跟踪置信度
)
```

### 显示参数
- 窗口大小：320×240（每个子窗口）
- 帧率：取决于摄像头和系统性能
- 分辨率：1280×720（可调整）

## 🚀 性能优化

### 建议配置
- **CPU**: Intel i5以上或AMD同级
- **内存**: 最少4GB RAM
- **摄像头**: 720p@30fps或更高

### 优化技巧
```python
# 降低分辨率提升性能
cap.set(cv2.CAP_PROP_FRAME_WIDTH, 640)
cap.set(cv2.CAP_PROP_FRAME_HEIGHT, 480)

# 调整检测参数
detector = HandDetector(
    min_detection_confidence=0.5,  # 降低阈值
    min_tracking_confidence=0.3    # 提升跟踪性能
)
```

## 🛠️ 故障排除

### 常见问题

**Q: 摄像头无法启动**
```python
# 尝试不同的摄像头索引
cap = cv2.VideoCapture(1)  # 或者 2, 3...
```

**Q: 手势识别不准确**
- 确保光线充足
- 手部完整出现在画面中
- 调整摄像头角度和距离

**Q: 程序运行缓慢**
- 降低摄像头分辨率
- 减少最大检测手数
- 关闭其他占用CPU的程序

**Q: 颜色显示异常**
- 检查显示器颜色设置
- 确认OpenCV正确安装

### 环境测试
运行测试脚本诊断问题：
```bash
python test_imports.py
```

## 🔮 扩展功能

### 可添加特性
- **手部追踪**：多帧手部轨迹
- **3D可视化**：利用深度信息
- **动作识别**：基于时序的手势
- **虚拟交互**：AR/VR集成
- **数据记录**：手势数据收集
- **实时流媒体**：网络传输

### 应用场景
- 🎮 手势游戏控制
- 🎯 虚拟现实交互
- 📚 手语识别系统
- 🏥 医疗康复训练
- 🎨 数字艺术创作
- 🤖 机器人控制

## 📄 许可证

本项目采用MIT许可证，仅用于学习和研究目的。

## 🆕 更新日志

### v2.0 - 骨骼轮廓优化版
- ✅ 增强骨骼结构可视化
- ✅ 彩色编码手指识别
- ✅ 实时手势识别系统
- ✅ 多视图显示界面
- ✅ 优化轮廓渲染算法
- ✅ 手指状态分析功能

### v1.0 - 基础版本
- ✅ 基础手部检测
- ✅ 简单轮廓绘制
- ✅ 多视图显示

## 👥 贡献

欢迎提交Issue和Pull Request来改进这个项目！

---

*享受探索手部检测和骨骼轮廓识别的乐趣！* 🖐️✨
